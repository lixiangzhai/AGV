### AGV

#### versionName : 1.9.0

versionCode : 14

1. 在`设置`-`梯控设置`中添加梯控通讯方式设置,分别为网络通讯,网络+LoRa通讯,LoRa通讯;
   1. **网络通讯:** 网络通讯使用鲁邦通梯控方案,和旧版本中的梯控功能一样;
   2. **网络+LoRa通讯:** 该方案在电梯外呼叫电梯时,使用网络,呼叫成功后转用LoRa通讯;
   3. **LoRa通讯:** 该方案全程使用LoRa通讯,适用于总楼层较低的情况;
   4. **网络+LoRa通讯**和**LoRa通讯**两种方案,均去除了等待电梯超时重新呼梯和梯内&梯外网络的设置;
2. 修复断网后使用二维码模式无法加载到缓存的bug;
3. 添加机型适配:robot10:飞船斜对角双激光, robot11:大狗斜对角双激光, robot12:飞船斜对角双激光加高款, robot13:大狗斜对角双激光加高款;
4. 修复3399安卓板在首次启动app时申请权限处理错误导致卡在Loading界面的bug;
5. 修复普通模式机身尺寸设置保存按钮未添加点击事件监听导致无法保存的bug;

#### versionName : 1.8.0

versionCode : 13

1. 添加调度模式,不兼容自由路线导航,暂不兼容梯控,门控;
   1. 在`设置`中添加`调度设置`:
      1. 打开调度模式后需设置`服务器地址`,`房间`,`房间密码`,如果未上传过地图到服务器,还需要上传地图到服务器;
      2. `服务器地址`: 根据服务器实际部署情况决定;
      3. `服务器设置`: 默认选择云服务器,选择本地服务器时,会登录至默认的房间,登录成功则切换至本地服务器成功,登录失败则切换失败;
      4. `房间设置`: 房间设置包含房间名和密码;
      5. `配置同步`: 设置完服务器地址和登入房间成功后,确保发送方和接收方处于同一网络,接收方点击`加入组播组`,发送方点击`开始组播`,会发送一次调度设置,接收到收到后点击确认按钮后,会首先保存服务器地址,之后尝试登录至房间,登录成功,则保存房间信息,登录失败不保存;
      6. `地图同步`: 部署完地图后,上传地图至房间,如果上传时房间内有其他机器在线,会强制下线,关闭房间;
      7. `网络测试`: 配置完服务器地址和房间设置后,可以使用该功能测试网络质量:
         1. 进入测试界面后,左侧显示当前wifi,MAC地址,RSSI(信号强度,范围:[-100,0],值越大,信号越强,一般来说,小于-70表示边缘信号),点击开始按钮,会和服务器进行通讯测试:app会向服务器发送数据包,服务器收到后进行回复,app收到回复后会继续发送数据包,如果出现丢包,测试就会中断; 
      8. `上线位置`: 设置好`服务器地址`,`房间设置`后,如果当前地图和服务器地图一致,则应选择上线位置,上线位置是类型为充电桩/出品点的点位,设置后机器上线后会检查当前位置和上线位置的距离偏差,角度偏差,如果距离超过1m或角度偏差大于30°,会提示重定位,添加重定位按钮,选择上线位置后可以在此处重定位;
      9. `默认充电桩设置`: 当使用不同类型的充电桩的机器混用时,需按照实际情况给每台机器指定一个默认充电桩;
      10. `房间配置`: 点击展开会尝试从服务器拉取最新的配置信息,修改完成后点击`房间配置`后的保存按钮同步配置到服务器,如果上传时房间内有其他机器在线,会强制下线,关闭房间:
         1. `动态规划路径开关`: 开启后,在创建配送任务&触发避让&到达避让点等情况下会先尝试绕过被占点位生成路线(主干道为单条双向环形/前往避让点效率高于绕路效率的地图不推荐打开,防止反复触发);
         2. `排队超时时长`: 由于多台机器路线.状态等组合情况非常多,机器堵塞时可能形成死锁,添加排队超时时长可以在机器长时间处于排队/避让状态时重新寻找避让点,以防止机器彻底堵死;
         3. `寻找避让点的路线深度`: 机器堵塞后,寻找避让点会根据设置的深度从当前所在路线向外寻找可避让路段,每找到一个非自动生成的路线点为一层,该参数根据地图实际部署情况进行设置;
         4. `定位范围`: 服务端会根据该参数匹配机器所在位置,如果范围内没有点,则无法创建任务,其他机器也会忽略该机器;
      11. 打开调度模式后如果未设置好`服务器地址`,`房间设置`,`上线位置`,无法使用调度模式; 
   2. 调度系统基本说明:
      1. 本系统为中央调度系统,由服务端进行交通管制,系统中可以创建房间,房间创建后,机器加入房间,并上传地图,同一房间内的机器需使用相同的地图,同一房间内不可以有重名机器;
      2. 地图部署:
         1. 调度系统要求使用固定路线;
         2. 充电桩数量要求不能少于机器数量;
         3. 支持多个出品点,出品点数量小于机器数量时,要求在出品点所在路线两侧空间足够处标注避让点,并连线至出品点所在路线;
         4. 节点(连接超过两条路线的点位)间距原则上不能小于将要运行的转弯半径最大的机器的转弯半径的4倍;
         5. 在节点附近,如果存在可避让的空间,可以加上避让点,一个节点旁的避让点数量最多为节点分支数量-1,多标无用;
         6. 单向环线中可以标注多个配送点,双向环线禁止主干道存在多个配送点,错误示例:
            ![img.png](img/img-20241209145334.png)
         7. 地图部署完成后,在app的`设置`-`调度设置`中开启调度模式,并加入房间,加入房间成功后上传地图至服务器,之后可将地图应用至其他机器;
      3. 基本逻辑:
         1. 地图中某个点位的连接点超过两个时,说明该点位处存在分叉,调度系统会根据地图中的分叉节点将路线分段,机器所在的路段,会锁死,不会给其他机器下发任务进入该路段;
         2. 机器端要前往某个点时,会调用调度系统的创建任务接口,创建成功后,服务端会根据路线占用情况下发任务信息给机器端:如果路段空闲,则会下发当前位置截止到存在分叉节点处前一个点作为局部路线,等机器行走至局部路线最后一个点后,服务端会根据下一段路线的占用情况,分配新的任务;如果路段中有其他机器,会根据实际情况分配排队/避让任务给机器;
         3. 服务端寻找避让点时,会根据机器当前所在路线的两个节点,筛选出向外两层的所有空闲路线后,找出最短的路线上的第一个路线点作为避让点;
         4. 如果某台机器的急停开关被按下,服务端会直接忽略该机器;
         5. 任务类型分为配送任务,充电任务,返航(去出品点)任务:
            - 配送任务: 无特殊逻辑;
            - 充电任务: 执行充电任务时,由服务端根据充电桩使用情况(通过判断在线机器的当前位置和正在执行的任务,定位在充电桩/正在前往某个充电桩则认为该充电桩被占用)分配充电桩给机器,**如无空闲充电桩,会直接结束任务**;
            - 返航任务: 执行返航(去出品点)任务时,服务端首先判断出品点数量,如超过1个,则分配空闲的出品点(判断条件同充电桩),如果只有一个/所有出品点都被占用,也会分配给机器;
         6. 如果机器端超过30s未向服务端发送心跳包,则认为该机器掉线,处理路线分配时会忽略该机器;
         7. 上传地图至服务器时,会检查房间内是否有在线机器,如果有,会推送地图更新通知到机器,并关闭房间;
   3. 进入app主界面时,如果开启调度模式,会检查机器是否上线,如果未上线,会尝试上线,上线接口会返回mqtt信息和点位信息,根据mqtt信息建立连接并订阅相关主题,成功后可以执行任务;
   4. 位于主界面时,如果mqtt连接断开,会尝试重连3次,第一次重试是在断开连接2s后,后面两次重试间隔是前一次间隔时长的两倍,3次都失败后弹出提示;
   5. 执行任务时,如果mqtt连接断开,如果处于暂停状态且倒计时开启,会暂停倒计时,尝试重连3次后,如果失败,任务结束;如果成功,如果处于暂停状态且倒计时暂停,则恢复倒计时,如果连接断开前任务处于导航状态,则重新创新任务,防止掉线期间丢失服务端推送的任务信息导致卡死;
   6. 收到服务端推送的地图更新时,机器端会重新上线至房间,如果处在任务中,则结束任务;
2. 修复对接充电桩失败超过最大重试次数后未重置重试次数导致的后续执行充电任务时对接失败无法触发重试的bug;
3. 修复除路线模式,呼叫模式外的其他模式任务正常结束后未重置任务执行状态导致的无法响应手机端下发任务的bug;
4. 对接充电桩失败不再重试,以降低丢定位的概率;
5. 添加针对ROS时间戳跳变的处理,在APP主界面触发直接重启ROS,重启完后根据重启前的机器坐标进行重定位,在任务中,如果机器在乘梯/过门控区/对接二维码/顶升/对接充电桩等状态时ROS时间戳跳变,直接结束任务,并重启ROS,其他情况(行走中/暂停中/到达配送点倒计时)暂停任务,重启ROS,重启完成后重定位,重定位成功可以恢复任务,重定位失败结束任务;
6. 适配4.0重定位逻辑(4.0导航在机器重定位后上报的initpose后跟的坐标不再是位置匹配坐标,而是重定位接口下发的坐标,导致app不能根据此坐标作为重定位完成时的机器坐标和重定位的目标位置计算距离&角度判断;
7. 目前存在问题:
   1. 部分情况存在反复触发避让/恢复的问题,第一版以稳定优先,效率问题后续版本优化,暂不处理;
   2. 路线节点距离较短时,局部路线可能会被其他机器遮挡,无法导航,导致卡死,暂时无法处理;
   3. 大狗,飞船等机型在较窄空间(可以通行,无法掉头)作为避让点时,会卡死,暂时不处理,后续对路线添加宽度等属性,机器寻找避让点时需判断路线宽度和转弯半径;
   4. 如果出品点/充电桩数量小于机器数量,在出品点/充电桩全部被占的情况下,机器前往出品点/充电桩会前往避让点排队,检测恢复条件时未检测所有出品点/充电桩的使用状态,暂不处理;
   5. 将机器堆在一堆开始任务/推至其他机器的局部路线上等不规范行为暂无法处理;
   6. 使用不同类型的充电桩的机器混用时,创建充电任务时,服务端可能派发到不适配的充电桩去,应对机器和充电桩做绑定处理;
   

#### versionName : 1.7.2

versionCode : 12

1. 修复路线模式下,标签码类型的点位关闭顶升控制后,不会触发到点倒计时的bug;
2. 修复手机端下发路线模式任务时,校验点位时滤掉了标签码类型的点位的bug;
3. 修复普通模式设置机器人尺寸后无法保存的问题;
4. 修复对接完二维码后未重置对接状态导致的无法暂停任务的bug;
5. 修复二维码模式下完成任务后未返回出品点,直接结束任务的bug;
6. 修复在使用325以下版本使用梯控时,出梯后没有释放电梯而是直接切换地图的bug;
7. 修复在梯控模式下,在非充电桩/出品点所在楼层下发返回充电桩/出品点的任务时,会因为针对当前楼层的点位类型校验问题(会检查有无充电桩/出品点类型的点)导致认为当前地图不合法的bug;
8. 修复梯控网关离线状态码大小写判断错误导致的提示错误;
9. 修复在1.7.0版本开始的二维码模式判断取货点和放货点是否相同无效的bug;
10. 修复路线模式在判断是否显示跳过当前点位时未判断任务是否已经完成&当前目标点是否是本任务最后一个目标点的bug;
11. 修复门控设置关门后直接开始导航时由于未更新关门状态,导致无法通过点击屏幕暂停任务的bug;
12. 修复路线模式第一个顶升动作设置为放下,当前顶升模块处于低位时,提示顶升抬起的提示错误;
13. 修复暂停任务后恢复任务/返回出品点也会检查当前目标点的顶升动作导致无法手动恢复任务/返回出品点的bug;
14. 修复路线模式当前目标点位需指定顶升动作时,暂停任务后还会有跳过当前点的按钮的bug;
15. 普通模式和二维码模式添加任务完成动作设置,可以选择任务完成后返回出品点/返回充电桩/留在原地;
16. 梯控模式下地图(别名&梯控相关点位符合要求)如果没有预期的点位类型,不再判定地图非法,普通模式&二维码模式在选择任务点位的界面,会显示当前地图中没有可以执行任务的点位;
17. 添加对多个出品点的支持:
    1. `设置`-`返航设置`中添加`出品点设置`,有单个出品点和多个出品点两个选项;
    2. 选择单个出品点时,和以往逻辑一样(加载点位时取点位列表中第一个出品点类型的点作为出品点使用);
    3. 选择多个出品点时,可以设置默认出品点,非梯控模式下,可以选择当前地图的任一出品点作为默认出品点,梯控模式下,可以选择出品点所在地图的任一出品点作为默认出品点;
    4. 当设置了多个出品点但是未选择默认出品点时,会根据任务完成时的位置寻找直线距离最近的出品点,梯控模式下如果出品点不在当前楼层,会找离出品点所在楼层的出梯点直线距离最近的出品点;
    5. 当设置了默认出品点时,如果切换导航模式/开关梯控模式,会清除默认出品点设置;
18. 添加应用升级功能,该功能暂不支持二次开发,给客户的源码无法使用升级功能:
    1. 在`设置`-`版本设置`中添加应用升级,点击检查更新后会查询最新版的版本号,如果当前版本低于最新版,则提示升级;
    2. 下载时会有弹窗显示下载进度,可以选择取消下载和后台下载,选择后台下载会在下载按钮后显示下载进度,点击后会进入前台下载模式,以弹窗形式显示进度;
    3. 前台下载完成后会自动安装升级包,后台下载完成后,会显示升级按钮,点击后可以选择安装升级包;
    4. 如果后台下载时退出应用/网络异常,则下载终止;如果后台下载完成,会记住升级包信息并弹出Download success的Toast,即使重新进入应用,版本设置界面也会有升级按钮;
19. 任务中播放背景音乐前添加背景音乐文件是否损坏的检测;
20. 开始任务前添加激光,imu,里程计,3D摄像头的状态检查;
21. 修复路线模式在拉取点位时未判断机器类型导致可以选择标签码类型的点位的bug;


#### versionName : 1.7.1

versionCode : 11

1. 处理special_plan(上报路线穿过的特殊区,导航版本RSNF1-3.2.7及以上)分包上报的情况;
2. 适配新的导航版本(导航版本RSNF1-3.2.6及以上)footprint接口(设置机器长宽),修改普通模式和二维码模式设置:导航版本RSNF1-3.2.6及以上,不设置机器长宽,必须设置搬运时的机身尺寸;
3. 将`设置`-`基础设置`中的就近停靠开关移到返航设置中;
4. 在`设置`-`基础设置`中添加防撞条开关,打开后,机器在发起导航前会切换io到防撞条,机器在下发顶升指令前会切换io到顶升io控制;
5. 优化乘梯流程,离开电梯到达进梯点时,就结束乘梯任务,缩短乘梯时的开门时长;
6. 进梯/出梯时添加超时处理,进出梯超过1min未成功,结束任务;
7. 修改路线模式:
   1. 拉取点位时添加标签码类型的点位;
   2. 选点时根据点位类型分页显示;
   3. 点位设置新增顶升动作设置,默认关闭,当点位为标签码类型时,可选自动顶升抬起/放下,当点位为其他类型时,可选手动顶升抬起/放下;
   4. 设置顶升动作时,会检查前后相关点位,设置顶升动作为抬起时,会检查当前点前面的点位中最后一个开启了顶升控制的点位是否设置为顶升放下,检查当前
      点后面的点位中第一个开启了顶升控制的点位是否设置为顶升放下,即检查是否有连续的顶升抬起动作或放下动作;
   5. 开始任务前会检查当前顶升模块位置,和任务中第一个顶升动作,是否冲突;
   6. 在路线设置界面最下方添加开始按钮,可以无需保存任务,直接执行,在此处开始任务会忽略任务循环执行开关的设置,当做关闭处理;
   7. 保存任务时如果检测到设置了任务结束重新开始路线巡航或任务循环执行,会检查顶升点的数量(不能为1),检查第一个顶升点和最后一个顶升的设置的动作是否相同;
   8. 任务中点击屏幕暂停时,如果当前目标点有设置顶升动作,则不会显示跳过当前配送点按钮;
8. 门控设置添加通讯方式选项,默认2.4GHz,可选LoRa(根据实际情况选择,LoRa和呼叫共用一个模块,地址为4,信道为5,使用前需更新);
9. 修复顶升模块抬起时乘梯切换地图后未重新设置机器长宽和激光宽度导致激光看到驮运的货物后无法导航的bug;
10. 3128在进入app后会打开无线调试;
11. 呼叫模块和门控模块添加断线检测,断线后进入重连逻辑,1s检测一次模块,最多10次,检测到模块后重新连接,使用门控时,任务中检测不到门控模块会直接结束任务,发送开关门指令时门控模块断开,如果重连成功,会重新发送开关门指令;
12. 如果门控通信方式选择LoRa,任务中发送开/关门指令如果收不到结果会进行重试,最多重试10次,1s一次;
13. 修复在app使用固定路线时,如果从未在标定位置界面标定过点位,拉取点位接口返回waypoints会为null,app未处理这种情况导致提示有误的bug;
14. 修复3568安卓板呼叫串口适配错误;
15. 修复到达候梯点后在检测到其他机器在乘梯时,倒计时结束后走梯内乘梯流程的bug;
16. 修复无法触发低电的bug;

#### versionName : 1.7.0

versionCode : 10

1. 重构点位缓存与拉取部分,抽取出来放到lib_points模块,接口不区分路线模式和任务模式.只有非梯控模式和梯控模式两个数据接口,一个异常接口;
2. 重写串口读写部分,使用自定义接口代替EventBus,减少项目中EventBus的使用;
3. 整理点位选择的适配器,整理任务数据,减少自定义数据类的使用;
4. 修改呼叫按钮的绑定:不再手动输入呼叫按钮,改为使用ROS/本地缓存(根据网络决定)
   数据,可选择配送类型,充电桩类型,出品点类型三种类型的点位绑定到呼叫按钮,绑定界面右侧展示已绑定的按钮和点位;
5. 按键呼叫任务无法执行时,弹出原因提示;
6. 在`设置`-`模式设置`-`二维码模式`中添加二维码实时识别数据的显示;
7. 在`设置`-`基础设置`中添加点位显示设置,可以选择滚动显示(默认)和分页显示;
8. 在`设置`-`门控设置`中添加风淋门停留时长设置,最短可以设置3s,风淋门标定规则:
   1. 自动路线模式: 特殊区名称后添加`_air_shower`的后缀(完整名称格式示例:`1001_air_shower`),当路线穿过连续的两个带有`_air_shower`后缀的门控特殊区时,在经过第一个特殊区后,会停留设置的时长后再继续;
   2. 固定路线模式: 点位名称前添加`air_shower_`前缀(完整名称格式示例:`air_shower_door_1001_1`),当生成的固定路线中连续两对门控点位都有`air_shower_`前缀时,在经过第一个特殊区后,会停留设置的时长后再继续;
9. 在`设置`-`门控设置`中添加门控测试的选项,点击进入门控测试界面,进入门控测试界面后,会寻找门控串口,找不到/打开失败时,
   会退出测试界面,打开成功后,可以输入门控编号,测试开关门,开关门日志显示在屏幕右侧;
10. 修改点位加载逻辑:
    添加对充电桩类型点位的数量检查,只能有一个充电桩;使用固定路线模式时,会额外检查自动路线模式(
    web端-标定位置)下的充电桩,有且只能有一个,且坐标和固定路线模式下的充电桩的坐标不能偏差过大(
    距离0.7m,角度±60度);
11. 修复呼叫按钮绑定的二维码模式任务,在开始任务倒计时期间点击弹窗取消会反复触发开始任务倒计时的bug;
12. 修复呼叫按钮绑定的二维码模式任务,在任务执行完成返回出品点时,无法响应新的呼叫任务的bug;
13. 重写路线模式界面,添加,修改任务和点位逻辑;
14. 路线模式点位新增属性:点位停留开关,默认打开,打开时,可以设置点位停留时长,关闭后,在执行任务到达该点位后,不会开启停留倒计时;
15. 针对导航版本3.2.5及以上版本,在使用梯控时:
    1. 要求每张地图必须标定一个`进梯点`类型的点位,进梯点要求标在电梯门前方约1m处,点位朝向电梯,每张地图上的进梯点相对位置要一致;
    2. 机器在候梯点呼梯后,等到电梯到达时,会先前往进梯点,生成路线后,根据路线长度和导航速度,计算出前往进梯点的耗时,以该时长的约6倍
       做导航超时处理(如果耗时的6倍小于15s,超时时长则为15s,超时后导航回到候梯点后开启重新呼梯倒计时);
    3. 机器到达进梯点后,按照原来逻辑进梯:开启电梯路径生成检测时,尝试生成进入电梯的路线,未开启时,直接导航进入电梯;
    4. 出电梯时,如果开启电梯路径生成检测,尝试生成前往进梯点的路线,
       生成失败:取消乘梯,开启重新呼梯倒计时;生成成功:前往进梯点,之后尝试生成前往出梯点的路线,
       生成失败:在进梯点释放电梯并切换地图重定位;生成成功,导航前往出梯点;
16. 所有远程任务都支持任务缓存队列,逻辑同按键呼叫(机器端收到呼叫任务后,会先校验点位/路线等信息,校验成功后,如果开启了任务缓存队列,
    将任务放入队列中,之后判断急停/电量/顶升状态/充电状态/导航状态/任务状态(机器在执行任务时,普通模式和二维码模式在执行完任务返回时
    可以执行远程任务,路线模式设置任务结束后重新开始时无法执行远程任务)/机器当前界面/等任务执行的前提条件,如果全部满足,则直接开始任务);
17. 支持手机端下发的回充和返航两种任务;
18. 任务暂停时按下绿色按钮可以恢复任务;
19. 添加门控发送开/关门指令失败的处理;
20. 针对3128主板,添加系统时间同步功能,进入app主界面前会尝试获取一次网络时间,获取成功则更新安卓系统时间,进入app后,每分钟检查一次系统
    时间戳,如果本次进入app后从未同步成功过网络时间或当前时间戳比上次获取到的网络时间要早,则尝试获取网络时间并同步系统时间;
21. 修复使用普通模式开启手动顶升控制时,未切换io到顶升控制引起的发送顶升指令无法正常执行的bug;
22. 在任务选点界面,如果检测到地图应用成功,退回主界面,提示检查定位;
23. 门控修改:只判断标签是否收到开/关门指令,不管控制盒回复;
24. 呼叫模式停留倒计时范围改为1-300(单位:秒);
25. 梯控适配鲁邦通新增的网关离线状态;

#### versionName : 1.6.2

versionCode : 9

1. 二维码模式(未开启梯控时)添加对呼叫按键的绑定;
2. 梯控模式添加`单网络`和`双网络`
   选项,该功能不支持3128安卓板,不支持通用3568安卓板,默认单网络,选择双网络后,需设置梯外网络和梯内网络(
   默认为电梯轿厢路由),设置时会跳转至wifi连接界面,选择wifi连接成功后会跳转回梯控设置界面,并保存设置的网络;
3. 开始任务前检查是否开启双网络,如果开启,则检查是否设置梯外网络和梯内网络,如未设置,无法开始任务;
4. 如果开启双网络,开始任务时和到达候梯点时,检测是否连接到梯外网络,如未连接,结束任务;
5. 如果开启双网络,机器在到达乘梯点后,切换至梯内网络,如果超时(10s),尝试切换回梯外网络,机器到达出梯点后,切换回梯外网络;
6. wifi连接界面右上角添加加号图标,点击后可以连接隐藏wifi;
7. 二维码模式添加对固定路线的适配;
8. 固定路线模式下,app导航时根据web端设置的路线宽度参数动态修改路线宽度;
9. 添加背景音乐,导航时播放,如果和其他语音提示冲突,将音量调低(
   如果设置的音量大于3,调整为3,否则,不调整),等其他语音播放完成后将背景音乐音量调整回设置的音量;
10. 普通模式和路线模式执行时,点击屏幕暂停时,根据剩余配送点数量动态显示跳过当前配送点按钮,普通模式会显示返回出品点按钮,路线模式下,如果设置的任务完成动作是返
    回出品点,则显示返回出品点按钮,否则不显示,其他模式都不显示返回出品点按钮;
11. 呼叫点位停留时间最小改为5s;
12. 按键呼叫支持绑定出品点和充电桩等非配送类型的点位;
13. 修复固定路线下门控点位类型错误的bug(使用了自动生成的点位类型,导致门控无效);
14. 3566添加对绿色按钮的适配;
15. 在路线模式界面,选中路线任务时,按下绿色按钮,可以直接开始任务;
16. 普通模式添加设置播放到达提示语时长,该设置在开启点位停留倒计时时有效,且必须小于点位停留时长(注意:
    点位停留倒计时最后十秒无法播放到达提示);
17. 修复3566第一次进入app时如果拒绝某个权限,后面会反复弹出授权弹窗,进入死循环的bug;
18. 添加对RSNF1开头的导航版本的绝对位置重定位适配;
19. 修复顶升控制时可以触发低电回充的bug;
20. 手动顶升时添加对充电状态的判断,充电时不能顶升;
21. 修复处理低电时未判断电量是否为机器真实电量的bug;
22. 针对按键呼叫做滤波处理,防止连点触发同时开启多个任务;
23. 去除切换建图/增量建图模式的弹窗;
24. 修复保存呼叫按键和二维码模式任务时使用"-"作为点位分隔符时,点位中也包含"-"时,会导致绑定失效的问题;

#### versionName : 1.6.1

versionCode : 8

1. 二维码模式(包含移动端)添加对梯控的适配;
2. 当机器执行任务时,如果机器人未发起导航时收到了新的导航指令,认为有人在web端操作机器人,直接结束任务;
3. 普通模式设置手动顶升后,开始任务时查询顶升状态并根据顶升状态设置机器长宽,激光宽度,任务结束时不会强制重置机器长宽和激光宽度;

#### versionName : 1.6.0

versionCode : 7

1. 重构呼叫模块,重写呼叫协议:https://www.kdocs.cn/l/cuAPYZyFSMFD:
    1. 收到呼叫任务后,判断`任务执行状态`,`急停状态`,`充电状态(是否线充)`,`导航模式(是否正在建图)`,
       `自检状态(是否正在重启ros)`,`低电状态`,`顶升状态(顶升模块是否在最低位,顶升动作是否完成)`,
       `当前activity是否可以允许执行任务(暂时只有MainActivity和SettingActivity允许)`,如果不
       满足任务执行条件,开启任务队列时,将任务放入队列中,未开启则直接忽略任务,满足任务执行条件时执行任务;
    2. 在普通模式&二维码模式&路线模式(选择任务完成返回出品点/充电桩时,且未开启任务循环执行开关)
       任务执行完将要返航时,会检查
       是否有待执行的呼叫任务,如果有,则不返航直接前往呼叫点位;
    3. 在普通模式&二维码模式&路线模式(选择任务完成返回出品点/充电桩时,且未开启任务循环执行开关)
       任务执行完将要返航时,如果电量
       高于任务电量,会更新机器人状态为可以响应移动端任务,如果触发急停,防跌等各种异常状态导致任务暂停,手动暂停任务,通过门控区,
       乘梯(从呼叫电梯到出梯后切换地图,重定位成功结束),这些状态,会更新机器人状态为无法响应移动端任务;
    4. 呼叫任务结束后,会有呼叫停留倒计时(其他模式任务结束不再有倒计时显示)
       ,倒计时期间不处理移动端下发的任务(在进入除主界面
       和设置界面两个界面时,其他如任务/语言选择/wifi连接等界面时,会结束停留倒计时);
    5. 移动端获取点位时,机器人端只从**缓存中取点**,如果本地缓存中没有点位,则无法成功获取到点位,所以,在使用移动端应用前,要确保
       机器人端已经拉取过对应模式的点位;
    6. 呼叫按钮适配梯控模式:
       梯控模式和非梯控模式的绑定信息存储在不同文件中,如果当前呼叫队列中有缓存的任务,切换导航模式(
       自由路线模式和固定路线模式)和梯控开关时会直接清空呼叫队列;
    7. 在`设置`-`模式设置`-`呼叫模式`中添加和移动端端应用的配对功能,机器人安卓端和移动端使用同一局域网时,可以使用局域网配
       对,当两者处于不同网络时,可以使用二维码配对,使用手机端应用扫描二维码即可;
    8. 添加`秘钥设置`
       ,在第一次安装应用时会自动生成一个长度为8的秘钥,后续可以在`设置`-`模式设置`-`呼叫模式`中修改,修改秘钥
       后所有移动端应用都需要重新和机器人配对;
2. 重构任务执行逻辑:
    1. 发起任务时记下当前目标点,目标点的属性等信息,导航完成时直接根据目标点属性进行对应的处理;
    2. 在收到开始导航时,会检查是否是由app发起,如果不是且收到开始导航/取消导航时有app端发起的未完成的导航,则根据app的逻辑重新发起导航;
3. 门控逻辑修改:
    1. 非固定路线模式下还是使用特殊区,特殊区名字即门控编号,在发起导航并收到穿过的特殊区时,app会判断*
       *特殊区的类型**,必须为
       **门控区**类型才会处理,app会判断进入特殊区的坐标到离开特殊区的坐标的距离,**小于0.3m**
       即认为特殊区异常,**忽略**该特殊区;
    2. 固定路线模式下无需标定特殊区,在门两侧各标一个**路线点**类型的点,该点以`door_xxxx`
       开头,其中,`xxxx`为四位数字组成的门控编号,app在发起导航后,会收到固定路线,之后会遍历
       整个路线,找到以`door_`开头的路线点后,再在路线中寻找`door_xxxx`开头的点,如果找到
       两个以`door_xxxx`开头的路线点,则认为这两个点中间为门,否则,不符合任一以上条件,直接忽略;
4. 修复路线模式路线未绑定点位还是可以开始任务的bug;
5. 修改呼叫模式mqtt重连逻辑:断开连接后一直重连,直到重连成功为止;
6. 添加机器别名的设置,第一次使用app时,在连接完wifi后设置别名,后续在`设置`-`基础设置`中可修改;
7. 给每种模式添加任务开始的倒计时开关和倒计时设置;
8. 将前往充电桩和出品点的速度和倒计时开关和倒计时设置放到`设置`-`返航设置`中;
9. 修复当应用处于非任务界面时,ros切换地图后,app端记录当前地图名称和别名,记录错误的bug(
   梯控模式下会引起乘梯时发送错误的楼层,导致乘梯失败);
10. 修复第一次进入app引导连接wifi界面点击屏幕左上角退出时未能关闭读取串口的线程的bug;

#### versionName : 1.5.2

versionCode : 6

1. 添加进梯检测开关,关闭时电梯开门后不进行检测,直接进入电梯;
2. 修改进梯检测可设置范围为:1-60s,其中设置小于5s时只取最后一次检测的结果,大于等于5s时取后三次的结果;
3. 修改可设置行走速度范围为:0.3-1.0m/s;
4. 机器人在离开电梯后如因网络等原因导致无法响应出梯ack或无法释放电梯,直接进入到切换地图的流程,不再因此终止任务;
5. 路线模式添加对`导航模式`-`固定路线模式`的支持;
6. `路线模式`添加任务结束`返回充电桩`的设置项,修改原地停留为`重新开始路线巡航`,选中时,跑完最后一个点后,检测
   **低电状态**和**上下班状态**,如果低电或下班,返回充电桩,否则,从第一个点开始重新开始;
7. `路线模式`添加任务循环执行的开关,开启后可以设置任务循环执行的时间间隔(至少1s);
8. `设置`-`基础设置`添加`对接充电桩`功能;
9. `设置`-`基础设置`-`重定位`功能修改:必须为座充状态才能重定位;
10. 乘梯时检测到查询到已存在本机的乘梯任务时,发送通知到云平台,乘梯等待电梯超时时,发送通知到云平台(
    只会尝试发送一次,失败不做缓存);
11. 添加对3566主板的适配;
12. 点位列表调整可显示长度和边距,点位名称长度超过5,缩小字号显示,内边距调小,以显示更多内容;
13. 在配送/暂停倒计时时按下绿色按钮,直接结束倒计时继续任务;
14. 修复在网页端切换地图,app未同步更新当前地图的bug;
15. 修复在开启上下班设置时,修改低电未判断上班电量引起的bug;
16.因通过点位名称绝对重定位接口不支持固定路线模式,改用坐标绝对重定位,当使用固定路线+梯控时,如果导航版本低于RSNF-3.2.2,出电梯切换地图后不支持绝对位置重定位,重定位失败重试时也只能使用匹配重定位;

#### versionName : 1.5.1

versionCode : 6

1. 修复无限触发重启导航的bug;

#### versionName : 1.5.0

versionCode : 6

1. 添加对负楼层的支持;
2. 修复从充电桩上充电时直接开始梯控任务时,到达候梯点后机器停在原地不动的bug(状态处理问题);
3. 修复执行完手机端的路线任务结束退回主界面(
   非路线模式选点界面,如普通模式选点界面,二维码模式选点界面)时,如果循环执行路线任务,未重新将任务模式设置为路线模式引起的bug;
4. 在`设置`-`基础设置`添加`顶升模块是否安装`的选项(只有机器类型选择为飞船/飞船Pro时可以选择),默认为*
   *已安装**,当选为未安装时,普通模式&二维码模式不能选择打开顶升控制,应用不再检查顶升模块状态;
5. 在`设置`-`基础设置`添加`就近停靠`的控制开关:
    - 此处的就近停靠优先级小于开启顶升后的优先级,例如:
      在普通模式下开启顶升开关,并且将就近停靠关闭,打开此处的就近停靠,当执行普通模式的任务时,会关闭就近停靠;
    -
   机器人在打开乘梯模式时,前往候梯点前会关闭就近停靠,一直到离开电梯切换地图并重定位完成时会重置就近停靠(
   普通模式根据是否开启顶升开关选择使用普通模式设置下的就近停靠还是此处的就近停靠,充电/去出品点重置为此处的就近停靠);
    - 开始任务时根据应用设置项设置就近停靠,结束任务时将就近停靠打开;

#### versionName : 1.4.0

versionCode : 5

1. 添加按键呼叫:
    - 呼叫模式暂时不支持梯控;
    - 添加呼叫模式,可以在`设置`-`模式设置`-`呼叫模式`中进行相关设置;
        - 呼叫模块配置 : **绑定呼叫按钮和点位**;
        - 运行速度 : 设置呼叫模式的速度;
        - 开启一键呼叫队列 : 设置是否启用呼叫队列(默认关闭);
            - 启用后在**执行任务时**如果收到呼叫,则待任务结束时前往呼叫点位(
              普通模式&路线模式&二维码模式在配送完最后一个点后前往,其他模式需任务结束返回到主界面后开启倒计时,等倒计时结束后才会执行下一次的呼叫任务);
            - 关闭后在执行任务时忽略收到的呼叫;
        - 呼叫点位停留时间 : 到达呼叫点位后/任务结束后,响应下一个呼叫任务的时间间隔(
          如果在该期间内收到呼叫,会等到倒计时结束再开始执行);
        - 呼叫点位缓存时间 : 收到呼叫后如果超时还未开始任务,则清除该任务(
          如果任务处在倒计时中且倒计时正常未暂停,则不清除);
    - 打开呼叫模块的串口成功时主界面顶部状态栏会显示对应图标;
    - 在`电量小于等于设置的最低电量`/`急停开关按下`/`线充`/`准备执行任务(检查点位信息时)`
      时,不响应呼叫任务,将呼叫任务缓存起来;
    - 在**建图模式**/**自检状态**/**上次任务异常结束**/**顶升模块活动中**/**开启梯控开关**
      时,不响应呼叫任务,并清除一切呼叫任务;
    - 在**主界面（包括每种模式选择点位的界面）和设置界面**
      时响应呼叫任务,在其他界面时,不响应呼叫任务时,不响应呼叫任务,将呼叫任务缓存起来,如果切换到主界面/设置界面,且机器状态无异常时,触发呼叫任务执行倒计时(
      使用呼叫点位停留时间);
2. 添加mqtt协议的在线任务功能
    - 在线任务暂不支持梯控,如果app打开梯控开关,则不处理在线任务;
    - 机器人和服务器正常连接时,主界面顶部状态栏会显示对应图标;
    - 和服务器连接断开时,自动重连三次(网络断开时不重试);
    - 如果收到安卓网络连接成功的广播时,自动重连;
    - 收到手机/平板端下发的呼叫任务时,处理逻辑同按键呼叫;
    - 收到手机/平板端下发的其他类型任务时,处理逻辑同手动任务;
    - 顶升模式处于中间位置时,不响应所有任务;
    - 在`电量小于等于设置的最低电量`/`急停开关按下`/`线充`/`顶升模块处于中间位置`时,不响应任何任务;
    - 在**主界面（包括每种模式选择点位的界面）和设置界面**时响应呼叫任务,在其他界面时,不响应呼叫任务时,呼叫任务缓存起来;
3. 梯控模式修改:
    - 添加对双开门电梯的支持(默认支持单开门电梯):
        - 建图时必须在电梯处建一张基础地图,该地图需扫描电梯内和电梯两个门外附近的环境,其他地图在该地图基础上增量建图;
4. 普通模式修改:
    - 开启手动顶升控制后,可以设置是否开启旋转恢复导航,就近停靠,顶升模块抬起时的机器宽度,激光宽度;
    - 除进入二维码模式选点界面时,其他模式不再强制顶升模块复位(降到低位)
      ,但是会检查顶升模块是否处于中间位置,处于中间位置时不能执行任务;
5. 其他:
    - 修复ros未联网时拉取点位失败的bug,重构拉取点位逻辑:先通过ros ip判断是否联网,如果未联网:
      使用本地缓存数据;如果联网,尝试使用ros最新数据,如果请求失败,使用本地缓存数据;
    - 修复`基础设置`界面切换模式弹窗点击取消按钮时未重置选择项的bug;
    - 修复`版本设置`界面ros版本显示错误的bug;
    - 修复3568连接wifi和开关wifi未做适配的bug;

#### versionName : 1.3.0

versionCode : 4

**必须结合最新导航(RSNF-3.2.0)和电源板(0.2.0)使用**

1. 导航模式修改:
    - 添加固定路线导航模式,可在`设置`-`基础设置`中切换;
    - 固定路线导航模式适配了`普通模式`,`去充电`,`去出品点`三种模式,其他模式暂不支持;
    - 固定路线模式兼容门控;
    - 普通模式添加手动顶升控制开关,开启手动顶升控制到达目标点后,需手动点击屏幕上的顶升抬起/顶升放下按钮,待顶升动作完成后,执行下一步动作,和点位停留倒计时只能二选一;
    - 顶升模式更名为二维码模式;
    - 二维码模式下添加顶升开关,默认打开,打开时和原顶升模式逻辑相同,关闭后,标签码导航完成时,界面切换为导航完成;
    - 使用二维码模式和普通模式时,如果机型为**飞船/飞船Pro**
      ,进入选择点位界面会检查顶升模块状态,如果顶升模块不是下降&完成状态,提示复位(
      结合最新的电源板版本使用);
    - 二维码模式连续对接二维码失败10次,结束任务;
2. 梯控修改:
   -
   电梯到达机器人所在楼层开门后,机器人检测是否可以进入电梯,期间播放避让提示,该检测时长可在`设置`-`梯控设置`
   中调整,范围6-60s,检测结束后,只取最后三次的检测结果,如果最后三次判断全部可以进入电梯,则进入,如果检测到有一次不能进入电梯,则释放电梯,倒计时重新发起乘梯;
    -
   添加重新发起乘梯时间间隔,该间隔为机器人检测到无法进入电梯后重新发起乘梯的时间间隔,可在`设置`-`梯控设置`
   中调整,范围1-10min;
    - 进梯点`ENTER`改为标**候梯点**类型的点位,**候梯点必须正对电梯门,保证电梯门打开时激光能扫描到电梯内部
      **,电梯点`INSIDE`改为标**乘梯点**类型的点位,出梯点`LEAVE`改为标**出梯点**类型的点位;
    - 添加乘梯超时重新呼梯的最大次数限制,如果在一次任务中连续5次因电梯超时未到达/未通知机器人出梯,直接结束任务;
    - 将默认楼层改为充电桩楼层和出品点楼层;
    - 按照选择配送点的顺序进行配送;
3. 门控修改:
    - 固定路线模式下的门控标点要求:特殊区前后0.5-1m必须各有一个节点(以实际场景为准);
    - 固定路线模式下要求特殊区两侧第一个点的方向朝向特殊区;
4. 其他:
    - 导航wifi第一次连接失败后5s自动重试一次;
    - 修改日志自动上传逻辑:应用日志和崩溃日志1min更新一次到ROS,所有日志大小达到5MB时,生成`.bak.n`
      后缀的备份;
    - 测试版本不上传崩溃日志到应用平台;
    - 添加越南语;
    - 添加上下班设置,在`设置`-`基础设置`
      中开启后可设置上下班时间,上班电量,在上班时间,如果在充电桩充电并且电量大于等于上班电量,前往出品点,在下班时间,如果未在充电,导航去充电;
    - 在`设置`-`基础设置`中添加速度设置,机器返航/前往充电桩/前往出品点时使用该速度;
    - 添加机型控制:只有在**导航后台**选择机型为**飞船/飞船Pro**后才可以使用**顶升功能**;
    - 适配3568;

#### versionName : 1.2.0

versionCode : 3

1. 添加门控:
    - 使用门控需在`设置`-`门控设置`中打开门控开关;
    - 使用门控需在门的位置标特殊区,特殊区名称与门控编号对应;
    - `门控设置`中的`关门模式`:
        - 先关门再导航: 机器人在通过门控区后停下,关门成功后再继续导航;
        - 直接导航: 机器人在通过门控区后不会停下,直接通过,同时发送关门指令;
    - 通过门控区时如按下急停/触发防跌等直接结束任务;
2. 梯控修改:
    - 添加多机乘梯排队逻辑;
    - 修改重定位逻辑:重定位一次后如果定位偏差过大使用绝对位置重定位;
    - 修复缓存点位数据时没有将梯控相关点缓存起来导致的使用缓存数据时找不到梯控相关点的bug;
    - 添加重新呼梯的间隔时间设置,可设置1-10min,建议设置3-5min,该间隔是为了处理概率性收不到梯控平台推送的出梯/进梯通知的问题;
3. 其他:
    - 普通模式添加到点是否倒计时的开关,任务完成返回出品点/原地停留的设置;
    - 添加全局异常处理,上传通知到云平台,日志上传到ros;
    - 更新语音合成库;

#### versionName : 1.1.0

versionCode : 2

1. 给每种模式添加单独的配置:
    - 普通模式: 速度设置和到点停留时长;
    - 路线模式: 速度设置;
    - 顶升模式: 速度设置;机器长宽;二维码校准方向和距离;激光宽度;二维码导航方向;旋转恢复;就近停靠;
2. 添加梯控模式:
    - 电梯能到达的楼层都需要建图,建图后修改地图名字为楼层对应的阿拉伯数字;
    - 每层楼必须要有`ENTER`(进梯等候点),`LEAVE`(出梯点),`INSIDE`(电梯内的点);
    - 需在设置界面打开梯控模式开关后选择默认楼层后使用;
    - 选择默认楼层会检测是否有标定`充电桩`,`出品点`,`ENTER`,`LEAVE`,`INSIDE`;
    - 机器使用过程中,在到达`ENTER`点后,一直到离开电梯到达`LEAVE`点,不允许点击屏幕暂停任务,如需中止任务,只能按下急停按钮;
    - 机器在使用前,需先确认机器实际所在楼层是否与正在使用的地图相对应,如不对应,需手动切换地图;

#### versionName : 1.0.0

versionCode : 1

1. 第一次使用时,需先选择语言,再设置wifi;
2. 主界面最上方是**常用状态**:`机器编号`,`android网络`,`时间`,`电量`;
   中间显示**配送模式**:`普通模式`,`路线模式`,`顶升模式`;
   最下方是**常用功能**:`网络连接`,`去充电`,`去出品点`,`更多设置`,`查看机器人信息`五个按钮;
    - 300ms内连续点击两次`机器编号`弹出弹窗**退出app**;
    - **普通模式:**
        1. 点击后会拉取配送点位,如果拉取失败,使用缓存点位;
           如果没有缓存点位,无法开始普通模式配送;
           如果没有出品点类型的点位,无法开始配送;
        2. 如果没标充电桩,会提示先标充电桩,但可以跳过直接开始任务;
        3. 普通模式选点数量和顺序无限制;
        4. 普通模式到达配送点后默认停留30s,初版暂不可调整该时间;
    - **路线模式:**
        1. 同普通模式;
        2. 同普通模式;
        3. 进入路线模式界面后默认是任务模式,该模式下无法修改路线;
           点击/拖动左上角任务模式到编辑模式,即可增/改/删路线;
           路线可设置任务结束时返回出品点还是停留在原地;
           如果选择任务结束时返回出品点,还可以设置循环执行该路线任务 : 设置任务再次执行间隔时间即可(
           时间为0表示任务只执行一次,手动取消任务或任务异常结束不会自动执行);
        4. 设置完路线参数后,可添加路线点:
           点击添加点位按钮会弹窗选择路线点,选择完点下一步,设置停留时长(
           设置停留时长为0表示到达后不开启倒计时);
        5. 编辑完路线后需切换到任务模式才能开始任务;
    - **顶升模式(机器需带顶升模块):**
        1. 点击后查询是否有标**标签码**,如果没标,无法进入顶升模式;
        2. 进入顶升模式后,选择起始位置和目的位置;
        3. 同一组中起始位置和目标位置不能是同一个点;
        4. 到达起始位置后执行顶升命令,抬起物品后前往目的位置放下物品;
        5. 如果前一组中的目的位置和当前要去的组中的起始位置是同一个点,在放下物品后需手动点击提示框中的继续,将物品再次抬起,前往当前组中的目的位置;
        6. 执行完任务后如果有出品点,返回出品点;如果没有,停在原地;
        7. 到达标签码位置后不可暂停任务,只能按急停按钮取消任务;
    - **网络连接:**
        1. 网络连接功能在第一次进入应用时默认连接安卓和导航wifi;
           之后连接网络时,连接完安卓wifi,弹窗提示是否连接导航网络;
        2. 安卓网络如果连接超时,弹窗提示是否直连导航网络;
    - **充电/去出品点:**
        - 查询是否有标该类型的点位,如果有,直接开始任务,如果没有,提示标点;
    - **更多设置:**
        1. 包含`基本设置`,`语言设置`,`网络设置`,`版本设置`;
        2. 基本设置:包含`媒体音量`,`屏幕亮度`,`低电量设置`,`运行速度`等;
        3. 语言设置:简体中文,繁体中文(粤语&湾),日语,韩语,泰语,英语,西班牙语,法语,德语,荷兰语,匈牙利语,阿拉伯语;
        4. 网络设置:安卓&导航wifi名称,IP地址,切换网络;
        5. 版本设置:app版本,导航版本,电源板版本;
    - **机器人信息:**
        - 详情参考app;
    - **自动充电:**
        - 只有主界面和设置界面会处理低电状态;
    - **定时重启导航:**
      -
      只有主界面和设置界面会处理导航的定时重启,导航开机时间大于5天,充电时长大于30分钟且正在充电,机器在充电桩位置(
      角度小于60度,距离小于0.7m);
3. 修复问题:
    1. 机器导航出现偏差导致机器完成导航后没有停在标签码正上方,识别不到二维码,暂由app处理该问题:
        - 标签码导航失败后导航去地图原点,同时判断机器位置,当机器离开导航失败点位1米后,重新导航回到该点;